(()=>{"use strict";function e(e){e.classList.toggle("popup_opened"),e.classList.contains("popup_opened")?document.addEventListener("keydown",t):document.removeEventListener("keydown",t)}function t(t){"Escape"===t.key&&e(document.querySelector(".popup_opened"))}function n(t,n){if(t.stopPropagation(),!t.target.classList.contains("popup__trigger"))return!1;e(n)}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===r(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u={Authorization:"45a234f7-547f-46f4-9fd9-7317cf035dbf","Content-Type":"application/json"},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.startsWith("/")||(e="/".concat(e)),fetch("".concat("https://nomoreparties.co/v1/wbf-cohort-6").concat(e),{method:t,headers:i(i({},u),r),body:n}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status," ").concat(e.body))}))},l=function(e){return a("/cards/likes/".concat(e),"PUT")},s=function(e){return a("/cards/likes/".concat(e),"DELETE")},f=null,p=function(){return f};function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.value=e?r:n}function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.preventDefault();var r=t.submitter,o=r.value;d(!0,r,o,n),e().then((function(){t.target.reset()})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){d(!1,r,o)}))}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=document.querySelector(".popup__large-pic"),_=document.querySelector(".popup__add-element"),b=document.querySelector(".elements__list"),g=document.querySelector(".element__template"),S=document.querySelector("#element-add-form"),h=document.querySelector(".popup__pic"),E=document.querySelector(".popup__pic-heading");function q(e){var t,r,o=g.content.cloneNode(!0),i=o.querySelector(".element__image"),c=o.querySelector(".element__trash"),u=o.querySelector(".element__like-counter"),f=o.querySelector(".element__like"),d=p();return i.src=e.link,i.alt=e.name,u.textContent=e.likes.length,e.likes.some((function(e){return e._id===d._id}))&&f.classList.add("element__like_active"),o.querySelector(".element__header").textContent=e.name,f.addEventListener("click",(function(t){!function(e,t,n){var r=e.target;(r.classList.contains("element__like_active")?s:l)(t).then((function(e){e&&(r.classList.toggle("element__like_active"),n.textContent=e.likes.length)})).catch((function(e){console.log(e)}))}(t,e._id,u)})),e.owner&&e.owner._id===d._id&&(c.addEventListener("click",(function(t){return function(e,t){(function(e){return a("/cards/".concat(e),"DELETE")})(t).then((function(){e.target.closest(".element").remove()})).catch((function(e){console.log(e)}))}(t,e._id)})),c.classList.add("element__trash-visible")),i.addEventListener("click",(function(t){return n=e.link,r=e.name,h.src=n,h.alt=r,void(E.textContent=r);var n,r})),t=v,"click",(r=i).classList.add("popup__trigger"),r.addEventListener("click",(function(e){return n(e,t)})),o}S.addEventListener("submit",(function(t){var n=t.target,r=n.elements["picture-link"].value,o=n.elements["element-name"].value;m((function(){return(t={name:o,link:r},a("/cards","POST",JSON.stringify(t))).then((function(t){var n;n=t,b.prepend(q(n)),e(_)}));var t}),t)}));var O=function(e){e.disabled=!0},L=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n.disabled=!1:O(n)},A=function(e,t,n,r,o){!function(e,t,n){n.validity.valid?function(e,t,n){var r=t.querySelector(".".concat(n.id,"-error"));r.classList.remove(e.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=t.querySelector(".".concat(n.id,"-error"));o.textContent=r,o.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(e,t,r),L(0,n,o)},j={formSelector:".popup__form",inputSelector:".popup__item-input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-disabled",inputErrorClass:"popup__item-error",errorClass:"popup__item-error-visible"};function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var k=function(){var t=document.querySelector(".popup__edit-profile"),n=document.querySelector(".popup__edit-avatar"),r=document.querySelector(".profile__info-name"),o=document.querySelector(".profile__info-details"),i=document.querySelector(".profile__image"),c=document.querySelector("#profile-form"),u=document.querySelector("#profile__button-edit"),l=document.querySelector("#profile-avatar-form"),s=function(e){r.textContent=e.name,o.textContent=e.about,i.src=e.avatar,function(e){f=e}(e)};c.addEventListener("submit",(function(n){var i=n.target,c=i.elements["element-profile-name"].value,u=i.elements["element-profile-description"].value;m((function(){return(n={name:c,about:u},a("/users/me","PATCH",JSON.stringify(n))).then((function(n){r.textContent=n.name,o.textContent=n.about,s(n),e(t)}));var n}),n)})),u.addEventListener("mousedown",(function(){var e,t,n,i;c.elements["element-profile-name"].value=r.textContent,c.elements["element-profile-description"].value=o.textContent,e=j,n=(t=c).querySelector(e.submitButtonSelector),(i=Array.from(t.querySelectorAll(e.inputSelector))).forEach((function(r){A(e,t,i,r,n)})),console.log("revalidate")})),l.addEventListener("submit",(function(t){var r=t.target.elements["element-avatar"].value;m((function(){return function(e){return a("/users/me/avatar","PATCH",JSON.stringify(e))}({avatar:r}).then((function(t){s(t),e(n)}))}),t)})),Promise.all([a("/users/me"),a("/cards")]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,c,u=[],a=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(u.push(r.value),u.length!==t);a=!0);}catch(e){l=!0,o=e}finally{try{if(!a&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return u}}(t,n)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1];s(o),function(e){var t=e.map(q);b.append.apply(b,function(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t))}(i)})).catch((function(e){console.log(e)}))};window.addEventListener("DOMContentLoaded",(function(e){var t,r,o;r=Array.from(document.querySelectorAll(".popup")),o=Array.from(document.querySelectorAll(".popup__trigger")),r.forEach((function(e){o.forEach((function(t){t.classList.contains("".concat(e.id,"-trigger"))&&t.addEventListener("mousedown",(function(t){return n(t,e)}))}))})),k(),function(e){return Array.from(document.querySelectorAll(e.formSelector))}(t=j).forEach((function(e){!function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);L(0,n,r),t.addEventListener("reset",(function(){O(r)})),n.forEach((function(o){o.addEventListener("input",(function(){A(e,t,n,o,r)}))}))}(t,e)}))}))})();