(()=>{"use strict";function e(e){e.classList.toggle("popup_opened"),e.classList.contains("popup_opened")?document.addEventListener("keydown",t):document.removeEventListener("keydown",t)}function t(t){"Escape"===t.key&&e(document.querySelector(".popup_opened"))}function n(t,n){if(t.stopPropagation(),!t.target.classList.contains("popup__trigger"))return!1;e(n)}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===r(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Array.from(document.querySelectorAll(".popup"));var c={Authorization:"45a234f7-547f-46f4-9fd9-7317cf035dbf","Content-Type":"application/json"},a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.startsWith("/")||(e="/".concat(e)),fetch("".concat("https://nomoreparties.co/v1/wbf-cohort-6").concat(e),{method:t,headers:i(i({},c),r),body:n}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status," ").concat(e.body))})).catch((function(e){console.log(e)}))},l=function(e){return a("/cards/likes/".concat(e),"PUT")},s=function(e){return a("/cards/likes/".concat(e),"DELETE")},f=null,p=function(e){return Array.from(document.querySelectorAll(e.formSelector))};function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var m=document.querySelector(".popup__large-pic"),v=document.querySelector(".popup__add-element"),y=document.querySelector(".elements__list"),_=document.querySelector(".element__template");function b(e){var t,r,o=_.content.cloneNode(!0),i=o.querySelector(".element__image"),u=o.querySelector(".element__trash"),c=o.querySelector(".element__like-counter"),p=o.querySelector(".element__like"),d=f;return i.src=e.link,i.alt=e.name,c.textContent=e.likes.length,e.likes.some((function(e){return e._id===d._id}))&&p.classList.add("element__like_active"),o.querySelector(".element__header").textContent=e.name,p.addEventListener("click",(function(t){!function(e,t,n){var r=e.target;(r.classList.contains("element__like_active")?s:l)(t).then((function(e){e&&(r.classList.toggle("element__like_active"),n.textContent=e.likes.length)}))}(t,e._id,c)})),e.owner&&e.owner._id===d._id&&(u.addEventListener("click",(function(t){return function(e,t){(function(e){return a("/cards/".concat(e),"DELETE")})(t).then((function(){e.target.closest(".element").remove()}))}(t,e._id)})),u.classList.add("element__trash-visible")),i.addEventListener("mousedown",(function(t){return n=m,r=e.link,o=e.name,n.querySelector(".popup__pic").src=r,void(n.querySelector(".popup__pic-heading").textContent=o);var n,r,o})),t=m,"mousedown",(r=i).classList.add("popup__trigger"),r.addEventListener("mousedown",(function(e){return n(e,t)})),o}document.querySelector("#element-add-form").addEventListener("submit",(function(t){t.preventDefault();var n,r=t.target,o=r.elements["picture-link"].value;(n={name:r.elements["element-name"].value,link:o},a("/cards","POST",JSON.stringify(n))).then((function(n){var o;o=n,y.insertBefore(b(o),y.firstChild),r.reset(),t.submitter.disabled=!0,e(v)}))}));var S=function(){a("/cards").then((function(e){if(e){var t=e.map((function(e){return b(e)}));y.append.apply(y,function(e){if(Array.isArray(e))return d(e)}(n=t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}var n}))},g=function(t){var r,o,i,u,c,l,s,d,m,v,y;!function(e){p(e).forEach((function(e){var t=e.querySelector('input[type="submit"]');e.addEventListener("submit",(function(){return t.value="Сохранение..."}))}))}(t),r=Array.from(document.querySelectorAll(".popup")),o=Array.from(document.querySelectorAll(".popup__trigger")),r.forEach((function(e){o.forEach((function(t){t.classList.contains("".concat(e.id,"-trigger"))&&t.addEventListener("mousedown",(function(t){return n(t,e)}))}))})),i=document.querySelector(".popup__edit-profile"),u=document.querySelector(".popup__edit-avatar"),c=document.querySelector(".profile__info-name"),l=document.querySelector(".profile__info-details"),s=document.querySelector(".profile__image"),d=document.querySelector("#profile-form"),m=document.querySelector("#profile__button-edit"),v=document.querySelector("#profile-avatar-form"),y=function(e){c.textContent=e.name,l.textContent=e.about,s.src=e.avatar,function(e){f=e}(e)},d.addEventListener("submit",(function(t){t.preventDefault();var n,r=t.target;(n={name:r.elements["element-profile-name"].value,about:r.elements["element-profile-description"].value},a("/users/me","PATCH",JSON.stringify(n))).then((function(t){c.textContent=t.name,l.textContent=t.about,r.reset(),r.elements["element-profile-name"].value=t.name,r.elements["element-profile-description"].value=t.about,e(i)}))})),m.addEventListener("mousedown",(function(){d.elements["element-profile-name"].value=c.textContent,d.elements["element-profile-description"].value=l.textContent})),v.addEventListener("submit",(function(t){t.preventDefault();var n,r=t.target;(n={avatar:r.elements["element-avatar"].value},a("/users/me/avatar","PATCH",JSON.stringify(n))).then((function(t){t&&(y(t),r.reset(),e(u))}))})),a("/users/me").then((function(e){e&&(y(e),S())})),function(e){p(e).forEach((function(e){var t=e.querySelector('input[type="submit"]');e.addEventListener("reset",(function(){return t.value="Сохранить"}))}))}(t)},h=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n.disabled=!1:n.disabled=!0};window.addEventListener("DOMContentLoaded",(function(e){var t={formSelector:".popup__form",inputSelector:".popup__item-input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-disabled",inputErrorClass:"popup__item-error",errorClass:"popup__item-error-visible"};g(t),function(e){p(e).forEach((function(t){!function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(".popup__button");h(0,n,r),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){n.validity.valid?function(e,t,n){var r=t.querySelector(".".concat(n.id,"-error"));r.classList.remove(e.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=t.querySelector(".".concat(n.id,"-error"));o.textContent=r,o.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(e,t,o),h(0,n,r)}))}))}(e,t)}))}(t)}))})();